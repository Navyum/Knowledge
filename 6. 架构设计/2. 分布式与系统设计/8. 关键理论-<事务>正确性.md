# ACID：
* 是数据库管理系统为了保证事务的正确性而提出来的一个理论，ACID包含四个约束
### 约束：
#### 1.Atomicity（原子性）
* 一个事务中的所有操作，要么全部完成，要么全部不完成，不会在中间某个环节结束。事务在执行过程中发生错误，会被回滚到事务开始前的状态，就像这个事务从来没有执行过一样。

#### 2.Consistency（完整性、一致性）
* 在事务开始之前和事务结束以后，数据库的完整性没有被破坏。
#### 3.Isolation（隔离性）
* 数据库允许多个并发事务同时对数据进行读写和修改的能力。隔离性可以防止多个事务并发执行时由于交叉执行而导致数据的不一致。事务隔离分为不同级别，包括读未提交（Read uncommitted）、读提交（read committed）、可重复读（repeatable read）和串行化（Serializable）。
#### 4.Durability（持久性）
* 事务处理结束后，对数据的修改就是永久的，即便系统故障也不会丢失。

#### 与CAP对比：
* 可以看到，ACID中的A（Atomicity）和CAP中的A（Availability）意义完全不同，而ACID中的C和CAP中的C名称虽然都是一致性，但含义也完全不一样。ACID中的C是指数据库的数据完整性，而CAP中的C是指分布式节点中的数据一致性。再结合ACID的应用场景是数据库事务，CAP关注的是分布式系统数据读写这个差异点来看，其实CAP和ACID的对比就类似关公战秦琼，虽然关公和秦琼都是武将，但其实没有太多可比性。

#### 延伸： BASE

# CAP定理
* **一致性（Consistency）**：每次读取要么获得最近写入的数据，要么获得一个错误。
* **可用性（Availability）**：每次请求都能获得一个（非错误）响应，但不保证返回的是最新写入的数据。
* **分区容忍（Partition tolerance）**：尽管任意数量的消息被节点间的网络丢失（或延迟），系统仍继续运行。
* 这里需要注意的是，CAP定理中的一致性与ACID数据库事务中的一致性截然不同。
* CAP关注的粒度是**数据**，而不是整个系统。
* CAP是忽略网络延迟的。
![图片](./IMG/关键理论-!数据!一致性.md/580facd5.png)
![图片](./IMG/关键理论-!数据!一致性.md/08587ca7.png)

## 常见组合：
* CA (consistency + availability)，这样的系统关注一致性和可用性，它需要非常严格的全体一致的协议，比如“两阶段提交”（2PC）。CA系统不能容忍网络错误或节点错误，一旦出现这样的问题，整个系统就会拒绝写请求，因为它并不知道对面的那个结点是否挂掉了，还是只是网络问题。唯一安全的做法就是把自己变成只读的。
* CP (consistency + partition tolerance)，这样的系统关注一致性和分区容忍性。它关注的是系统里大多数人的一致性协议，比如：Paxos算法（Quorum类的算法）。这样的系统只需要保证大多数结点数据一致，而少数的结点会在没有同步到最新版本的数据时变成不可用的状态。这样能够提供一部分的可用性。
* AP (availability + partition tolerance)，这样的系统关心可用性和分区容忍性。因此，这样的系统不能达成一致性，需要给出数据冲突，给出数据冲突就需要维护数据版本。Dynamo就是这样的系统。


### 分布式事务相关算法：
* 两阶段提交（2PC）：
    * 准备阶段：协调者向所有参与者发送准备请求，参与者执行预操作并记录日志，但不提交。
    * 提交阶段：如果所有参与者都准备就绪，协调者发送提交请求，参与者提交操作；否则，协调者发送回滚请求，参与者回滚操作。
* 三阶段提交（3PC）：
    * 在两阶段提交的基础上增加了一个预备提交阶段，进一步减少了协调者和参与者的等待时间。

* TCC：
    * 